<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LDSS Todo App - Standalone Demo</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .container {
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      max-width: 600px;
      width: 100%;
      padding: 40px;
    }

    h1 {
      color: #667eea;
      margin-bottom: 10px;
      font-size: 32px;
    }

    .subtitle {
      color: #666;
      margin-bottom: 30px;
      font-size: 14px;
    }

    .input-group {
      display: flex;
      gap: 10px;
      margin-bottom: 30px;
    }

    input[type="text"] {
      flex: 1;
      padding: 15px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 16px;
      transition: border-color 0.3s;
    }

    input[type="text"]:focus {
      outline: none;
      border-color: #667eea;
    }

    button {
      padding: 15px 30px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s;
    }

    button:hover {
      background: #5568d3;
    }

    button:active {
      transform: scale(0.98);
    }

    .stats {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      display: flex;
      justify-content: space-between;
      font-size: 14px;
      color: #666;
    }

    .todo-list {
      list-style: none;
    }

    .todo-item {
      background: #f8f9fa;
      padding: 15px;
      margin-bottom: 10px;
      border-radius: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: transform 0.2s;
    }

    .todo-item:hover {
      transform: translateX(5px);
    }

    .todo-item.completed {
      opacity: 0.6;
    }

    .todo-item.completed .todo-text {
      text-decoration: line-through;
    }

    .todo-text {
      flex: 1;
      font-size: 16px;
      color: #333;
    }

    .todo-actions {
      display: flex;
      gap: 10px;
    }

    .btn-small {
      padding: 8px 15px;
      font-size: 14px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      transition: background 0.3s;
    }

    .btn-complete {
      background: #4caf50;
      color: white;
    }

    .btn-complete:hover {
      background: #45a049;
    }

    .btn-delete {
      background: #f44336;
      color: white;
    }

    .btn-delete:hover {
      background: #da190b;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #999;
    }

    .empty-state-emoji {
      font-size: 64px;
      margin-bottom: 20px;
    }

    .footer {
      margin-top: 30px;
      text-align: center;
      color: #999;
      font-size: 12px;
    }

    .footer a {
      color: #667eea;
      text-decoration: none;
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: #667eea;
      font-size: 18px;
    }

    .error {
      background: #f44336;
      color: white;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üìù LDSS Todo App</h1>
    <p class="subtitle">v0.1.0 - Standalone Demo</p>

    <div id="loadingState" class="loading">
      üöÄ Initializing LDSS...
    </div>

    <div id="errorState" style="display: none;"></div>

    <div id="appContent" style="display: none;">
      <div class="input-group">
        <input 
          type="text" 
          id="todoInput" 
          placeholder="What needs to be done?"
          onkeypress="if(event.key==='Enter') addTodo()"
        >
        <button onclick="addTodo()">Add Todo</button>
      </div>

      <div class="stats">
        <span id="totalCount">Total: 0</span>
        <span id="activeCount">Active: 0</span>
        <span id="completedCount">Completed: 0</span>
      </div>

      <ul class="todo-list" id="todoList"></ul>
    </div>

    <div class="footer">
      Powered by <a href="https://github.com/Tryboy869/ldss" target="_blank">LDSS v0.1.0</a>
    </div>
  </div>

  <script>
    // ============================================
    // LDSS SDK Embedded (v0.1.0)
    // ============================================
    class LDSS {
      constructor(config) {
        if (!config || !config.projectName) {
          throw new Error('[LDSS] projectName is required');
        }
        this.projectName = config.projectName;
        this.version = '0.1.0';
        this.workers = {};
        this.initialized = false;
      }

      async init() {
        if (this.initialized) return this;
        console.log(`[LDSS v${this.version}] Initializing...`);

        try {
          this.workers.db = await this._initIndexedDB();
          this.workers.search = await this._initSearch();
          this.initialized = true;
          console.log('‚úÖ [LDSS] Initialized successfully');
          return this;
        } catch (error) {
          console.error('‚ùå [LDSS] Init failed:', error);
          throw error;
        }
      }

      async store(collection, data) {
        this._checkInitialized();
        const id = data.id || this._generateId();
        const record = { ...data, id, _createdAt: Date.now() };
        await this.workers.db.store(collection, record);
        
        const searchText = this._extractSearchableText(record);
        if (searchText) {
          this.workers.search.index(collection, id, searchText);
        }
        
        return { success: true, id };
      }

      async get(collection, id) {
        this._checkInitialized();
        return await this.workers.db.get(collection, id);
      }

      async getAll(collection) {
        this._checkInitialized();
        return (await this.workers.db.getAll(collection)) || [];
      }

      async delete(collection, id) {
        this._checkInitialized();
        await this.workers.db.delete(collection, id);
        this.workers.search.remove(collection, id);
        return { success: true };
      }

      _checkInitialized() {
        if (!this.initialized) {
          throw new Error('[LDSS] Not initialized. Call await db.init()');
        }
      }

      _generateId() {
        return `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
      }

      _extractSearchableText(record) {
        const fields = ['title', 'name', 'text', 'content'];
        return fields
          .filter(f => record[f])
          .map(f => record[f])
          .join(' ')
          .toLowerCase();
      }

      async _initIndexedDB() {
        const dbName = `ldss_${this.projectName}`;
        return new Promise((resolve, reject) => {
          const request = indexedDB.open(dbName, 1);
          
          request.onerror = () => reject(request.error);
          
          request.onsuccess = () => {
            const db = request.result;
            resolve({
              db,
              async store(collection, record) {
                return new Promise((resolve, reject) => {
                  try {
                    const tx = db.transaction([collection], 'readwrite');
                    const store = tx.objectStore(collection);
                    const req = store.put(record);
                    req.onsuccess = () => resolve();
                    req.onerror = () => reject(req.error);
                  } catch (e) {
                    reject(e);
                  }
                });
              },
              async get(collection, id) {
                return new Promise((resolve, reject) => {
                  try {
                    const tx = db.transaction([collection], 'readonly');
                    const store = tx.objectStore(collection);
                    const req = store.get(id);
                    req.onsuccess = () => resolve(req.result);
                    req.onerror = () => reject(req.error);
                  } catch (e) {
                    reject(e);
                  }
                });
              },
              async getAll(collection) {
                return new Promise((resolve, reject) => {
                  try {
                    const tx = db.transaction([collection], 'readonly');
                    const store = tx.objectStore(collection);
                    const req = store.getAll();
                    req.onsuccess = () => resolve(req.result);
                    req.onerror = () => reject(req.error);
                  } catch (e) {
                    reject(e);
                  }
                });
              },
              async delete(collection, id) {
                return new Promise((resolve, reject) => {
                  try {
                    const tx = db.transaction([collection], 'readwrite');
                    const store = tx.objectStore(collection);
                    const req = store.delete(id);
                    req.onsuccess = () => resolve();
                    req.onerror = () => reject(req.error);
                  } catch (e) {
                    reject(e);
                  }
                });
              }
            });
          };
          
          request.onupgradeneeded = (event) => {
            const db = event.target.result;
            const collections = ['todos', 'notes', 'default'];
            collections.forEach(name => {
              if (!db.objectStoreNames.contains(name)) {
                db.createObjectStore(name, { keyPath: 'id' });
              }
            });
          };
        });
      }

      async _initSearch() {
        const index = new Map();
        return {
          index(collection, id, text) {
            index.set(`${collection}:${id}`, { collection, id, text });
          },
          remove(collection, id) {
            index.delete(`${collection}:${id}`);
          }
        };
      }
    }

    // ============================================
    // TODO APP LOGIC
    // ============================================
    let db;
    let todos = [];

    async function initApp() {
      try {
        db = new LDSS({ projectName: 'TodoApp-Standalone' });
        await db.init();
        
        document.getElementById('loadingState').style.display = 'none';
        document.getElementById('appContent').style.display = 'block';
        
        await loadTodos();
      } catch (error) {
        console.error('Init failed:', error);
        document.getElementById('loadingState').style.display = 'none';
        document.getElementById('errorState').style.display = 'block';
        document.getElementById('errorState').className = 'error';
        document.getElementById('errorState').textContent = 
          `Failed to initialize: ${error.message}. Check browser console.`;
      }
    }

    async function addTodo() {
      const input = document.getElementById('todoInput');
      const title = input.value.trim();
      
      if (!title) {
        alert('Please enter a todo!');
        return;
      }

      try {
        await db.store('todos', {
          title,
          completed: false,
          createdAt: Date.now()
        });
        
        input.value = '';
        await loadTodos();
      } catch (error) {
        console.error('Add todo failed:', error);
        alert('Failed to add todo');
      }
    }

    async function toggleTodo(id) {
      try {
        const todo = todos.find(t => t.id === id);
        if (!todo) return;
        
        await db.delete('todos', id);
        await db.store('todos', {
          ...todo,
          completed: !todo.completed
        });
        
        await loadTodos();
      } catch (error) {
        console.error('Toggle failed:', error);
      }
    }

    async function deleteTodo(id) {
      if (!confirm('Delete this todo?')) return;
      
      try {
        await db.delete('todos', id);
        await loadTodos();
      } catch (error) {
        console.error('Delete failed:', error);
      }
    }

    async function loadTodos() {
      try {
        todos = await db.getAll('todos');
        todos.sort((a, b) => b.createdAt - a.createdAt);
        renderTodos();
        updateStats();
      } catch (error) {
        console.error('Load failed:', error);
      }
    }

    function renderTodos() {
      const list = document.getElementById('todoList');
      
      if (todos.length === 0) {
        list.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-emoji">üéâ</div>
            <p>No todos yet. Add one above!</p>
          </div>
        `;
        return;
      }

      list.innerHTML = todos.map(todo => `
        <li class="todo-item ${todo.completed ? 'completed' : ''}">
          <span class="todo-text">${escapeHtml(todo.title)}</span>
          <div class="todo-actions">
            <button 
              class="btn-small btn-complete" 
              onclick="toggleTodo('${todo.id}')"
            >
              ${todo.completed ? '‚Ü©Ô∏è Undo' : '‚úì Done'}
            </button>
            <button 
              class="btn-small btn-delete" 
              onclick="deleteTodo('${todo.id}')"
            >
              üóëÔ∏è Delete
            </button>
          </div>
        </li>
      `).join('');
    }

    function updateStats() {
      const total = todos.length;
      const completed = todos.filter(t => t.completed).length;
      const active = total - completed;
      
      document.getElementById('totalCount').textContent = `Total: ${total}`;
      document.getElementById('activeCount').textContent = `Active: ${active}`;
      document.getElementById('completedCount').textContent = `Completed: ${completed}`;
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Start app
    initApp();
  </script>
</body>
</html>